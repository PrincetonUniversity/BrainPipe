#!/usr/bin/env python2
# -*- coding: utf-8 -*-
"""
Created on Tue Jul 25 09:20:13 2017

@author: tpisano
"""
from skimage.morphology import erosion, dilation, square, disk, ball, white_tophat, black_tophat, watershed
from tools.utils.io import change_bitdepth, load_memmap_arr
from skimage import filters
from skimage.feature import peak_local_max, blob_log
from skimage.measure import label
from scipy import ndimage
from skimage.external import tifffile
from skimage.exposure import cumulative_distribution
import numpy as np
from math import ceil
from tools.utils.io import change_bitdepth, load_memmap_arr, makedir, make_memmap_from_tiff_list
from skimage.external import tifffile
import os, sys, numpy as np, cv2
#from numba import jit
#%%
if __name__ == '__main__':
    vol=['/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1131.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1132.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1133.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1134.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1135.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1136.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1137.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1138.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1139.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1140.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1141.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1142.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1143.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1144.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1145.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1146.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1147.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1148.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1149.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1150.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1151.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1152.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1153.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1154.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1155.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1156.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1157.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1158.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1159.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1160.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1161.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1162.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1163.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1164.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1165.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1166.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1167.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1168.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1169.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1170.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1171.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1172.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1173.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1174.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1175.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1176.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1177.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1178.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1179.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1180.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1181.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1182.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1183.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1184.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1185.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1186.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1187.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1188.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1189.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1190.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1191.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1192.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1193.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1194.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1195.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1196.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1197.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1198.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1199.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1200.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1201.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1202.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1203.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1204.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1205.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1206.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1207.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1208.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1209.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1210.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1211.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1212.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1213.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1214.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1215.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1216.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1217.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1218.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1219.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1220.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1221.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1222.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1223.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1224.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1225.tif']
    vol.sort()
    vol = vol[:15]
    #vol = np.asarray([tifffile.imread(ii) for ii in vol])
    #cvol = cell_detect(vol, planes_to_collapse=15, shrink_volume=False, verbose=True)
    kwargs={'planes_to_collapse': 15,
            'cores':1,
            'clip_percentile': [50, 99.99],
            'maxIP_erosion_and_dilation_disk_size': 1,
            'medianIP_erosion_and_dilation_disk_size': 50,
            'white_tophat_disk_size': 30,
            'output_step' : 'morphological_laplace',
            'peak_local_max_minimum_distance' : 2,
            'peak_local_max_relative_threshold' : 0.05,
            'morphological_laplace' : 5
            }
    
    cvol = preprocess_for_cnn(vol, **kwargs)
        
    ##TO DO: function to return a pre-step for ccn. Also put this into cnn's prob map pipeline to see how good this is.
    #need to load and generate mem_mapped arrays
    #then train CNN OR use a combination of wtsd points/morpho-laplace with ben's 2d cell
    #make an ROC curve + sen/spec tests

    from tools.objectdetection.find_cells import cell_detect  
    #disp, centers, contours = cell_detect(llsub, cell_area_thresh=[1, 50000], cell_circularity_thresh=0.01, abs_intensity_percentile_thresh=0.01, edge_finding_param=0.2, sigma=2, dilation_kernel_size=2)
    #consider having an if statement that can output the watershed "points" where large circles of some radius kept (for the CNN)

    #Test 2:
    vol = ['/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1205.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1206.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1207.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1208.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1209.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1210.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1211.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1212.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1213.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1214.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1215.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1216.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1217.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1218.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1219.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1220.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1221.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1222.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1223.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1224.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1225.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1226.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1227.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1228.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1229.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1230.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1231.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1232.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1233.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1234.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1235.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1236.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1237.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1238.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1239.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1240.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1241.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1242.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1243.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1244.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1245.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1246.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1247.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1248.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1249.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1250.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1251.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1252.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1253.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1254.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1255.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1256.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1257.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1258.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1259.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1260.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1261.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1262.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1263.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1264.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1265.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1266.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1267.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1268.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1269.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1270.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1271.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1272.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1273.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1274.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1275.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1276.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1277.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1278.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1279.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1280.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1281.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1282.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1283.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1284.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1285.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1286.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1287.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1288.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1289.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1290.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1291.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1292.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1293.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1294.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1295.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1296.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1297.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1298.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1299.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1300.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1301.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1302.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1303.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1304.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1305.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1306.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1307.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1308.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1309.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170207_db_bl6_crii_rpv_01/full_sizedatafld/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_ch02/20170207_db_bl6_crii_rpv_01_488_555_647_0005na_1hfsds_z3um_225msec_75plas_C02_Z1310.tif']
    vol.sort()

#%%
def preprocess_for_cnn(vol, **kwargs):
    '''Function to preprocess image before passing to cnn
    
    Inputs
    ------------
    vol: list of tifffiles or 3d np.array. In theory IO should be faster with mem_mapped array
    
    Optional kwargs:
    planes_to_collapse: number of zplanes to max/median project for image analysis, should be slightly larger than lightsheet thickness / zstep (i.e. 12 / 3 ==~5)
    clip_percentile = [50, 99.99]
    maxIP_erosion_and_dilation_disk_size = 1
    medianIP_erosion_and_dilation_disk_size = 50
    white_tophat_disk_size = 30
    output_step = (default) 'morphological_laplace'
                            'watershed'
    peak_local_max_minimum_distance = 2
    peak_local_max_relative_threshold=0.05
    morphological_laplace = 5
    verbose=True
    cores: if parallelizing
    par_type: 'mp' - faster, better for cluster
              'par_proc' - slower but gives status bar
              
    kwargs={'vol':vol, 
            'planes_to_collapse': 15,
            'cores':10,
            'clip_percentile': [50, 99.99],
            'maxIP_erosion_and_dilation_disk_size': 1,
            'medianIP_erosion_and_dilation_disk_size': 50,
            'white_tophat_disk_size': 30,
            'output_step' : 'morphological_laplace',
            'peak_local_max_minimum_distance' : 2,
            'peak_local_max_relative_threshold' : 0.05,
            'morphological_laplace' : 5
            }
              
              
    '''
    delete_after=False
    assert np.any((type(vol) == list, type(vol) == str, str(type(vol))=="<class 'numpy.core.memmap.memmap'>")), 'vol must be a list of tifffiles or a path to a memory mapped array'
    if type(vol) == str: assert vol[-4:] == '.npy', 'if passing string for vol, it must be a .npy memory mapped array'
    if type(vol) == list:
        delete_after=True
        flnm = os.path.splitext(vol[0])[0]+'.npy'
        make_memmap_from_tiff_list(vol, flnm)
        vol = flnm
    if str(type(vol)) == "<class 'numpy.core.memmap.memmap'>": vol = vol.filename
    
    ####PREPROCESSING params
    param_dict={}
    param_dict['planes_to_collapse'] = kwargs['planes_to_collapse'] if 'planes_to_collapse' in kwargs.keys() else 15
    param_dict['clip_percentile'] = kwargs['clip_percentile'] if 'clip_percentile' in kwargs.keys() else [50,99]
    param_dict['maxIP_erosion_and_dilation_disk_size'] = kwargs['maxIP_erosion_and_dilation_disk_size'] if 'maxIP_erosion_and_dilation_disk_size' in kwargs.keys() else 1
    param_dict['medianIP_erosion_and_dilation_disk_size'] = kwargs['medianIP_erosion_and_dilation_disk_size'] if 'medianIP_erosion_and_dilation_disk_size' in kwargs.keys() else 50
    param_dict['white_tophat_disk_size'] = kwargs['white_tophat_disk_size'] if 'white_tophat_disk_size' in kwargs.keys() else 30
    param_dict['peak_local_max_minimum_distance'] = kwargs['peak_local_max_minimum_distance'] if 'peak_local_max_minimum_distance' in kwargs.keys() else 2
    param_dict['peak_local_max_relative_threshold'] = kwargs['peak_local_max_relative_threshold'] if 'peak_local_max_relative_threshold' in kwargs.keys() else 0.05
    param_dict['verbose'] = kwargs['verbose'] if 'verbose' in kwargs.keys() else True
    verbose = kwargs['verbose'] if 'verbose' in kwargs.keys() else True
    param_dict['output_step'] = kwargs['output_step'] if 'output_step' in kwargs.keys() else 'morphological_laplace'
    param_dict['cores'] = kwargs['cores'] if 'cores' in kwargs.keys() else 1
    par_type=kwargs['par_type'] if 'par_type' in kwargs.keys() else 'mp'
    cores = kwargs['cores'] if 'cores' in kwargs.keys() else 1    
    param_dict['vol']=vol
    
    if verbose: sys.stdout.write('\n   Preprocessing planes for cnn:'); sys.stdout.flush()

    dims = load_memmap_arr(vol).shape
    if dims[0]==2: dims = dims[1:]

    #single thread - use for limited mem
    if cores == 1 or cores == None or cores == False or cores == 0:
        outvol = []
        for i in range(dims[0]):
            outvol.append(preprocess_for_cnn_helper((i, param_dict))[1])
    #parellize
    else:
        iterlst = [(i, param_dict) for i in range(dims[0])]
        if par_type == 'par_proc':
            from tools.utils.process_local import parallel_process
            outvol = parallel_process(iterlst, preprocess_for_cnn_helper, n_jobs=cores)
        else:
            import multiprocessing as mp
            p=mp.Pool(cores)
            outvol = p.starmap(preprocess_for_cnn_helper, iterlst)
            p.terminate()
        #sort
        outvol = {k:v for k,v in outvol}
        outvol = [outvol[i] for i in range(len(outvol))]
        
    if delete_after: os.remove(flnm)

    return np.asarray(outvol)

def preprocess_for_cnn_helper(i, param_dict):
    '''Consider addding a watershed step (or just circle given the center + a predetermined radius) to the training set before training. This could allow for better training.
    '''
    
    #params
    planes_to_collapse = param_dict['planes_to_collapse']
    verbose = param_dict['verbose']
    low, high = param_dict['clip_percentile'] # 50, 99.99
    max_d = param_dict['maxIP_erosion_and_dilation_disk_size'] #1
    med_d = param_dict['medianIP_erosion_and_dilation_disk_size'] #50
    white_tophat_disk = param_dict['white_tophat_disk_size'] #30
    peak_local_max_minimum_distance = param_dict['peak_local_max_minimum_distance'] #2
    peak_local_max_relative_threshold = param_dict['peak_local_max_relative_threshold'] #0.05
    output_step = param_dict['output_step']
    vol = load_memmap_arr(param_dict['vol'], mode='c') #might need to change to r+, was rparam_dict['vol']
    if vol.shape[0] == 2 and len(vol.shape)==4: vol = vol[0]
    
    if verbose: sys.stdout.write('\n      Plane {} of {}.'.format(i, len(vol))); sys.stdout.flush()
    
    #handle inputs
    vol = np.asarray(vol[np.max((i-int(ceil(planes_to_collapse / 2.0)), 0)):i+int(ceil(planes_to_collapse / 2.0))])

    #consider clipping some percentile
    vol = clip_percentile(vol, low=low, high=high)
    
    # erode and dilate and subtract max from median im
    sub = erode_and_dilate(max_d, med_d, vol)
    
    #consider adjusting gamma
    #from skimage.exposure import adjust_gamma
    #sub = adjust_gamma(sub, gamma=0.95) #slight increase to catch weaker cells
    
    #consider morphogradient via opencv
    #http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_morphological_ops/py_morphological_ops.html
    #gradient = cv2.morphologyEx(img, cv2.MORPH_GRADIENT, kernel)
      
    #decent
    #gsub = ndimage.morphological_gradient(sub, 5)
    #wtsd = watershed(gsub, label(pk))
    #gosub = ndimage.grey_opening(sub, 5)
    
    #find holes and bright spots then manage the two
    #bt seems to be very good at delinating clusters of cells -- make this + spots black on image to parse out cells before watershedding
    delta_wt_bt = tophat(white_tophat_disk, sub)

    #find peaks of remaining image    
    pk = change_bitdepth(peak_local_max(delta_wt_bt, min_distance=peak_local_max_minimum_distance, threshold_rel=peak_local_max_relative_threshold, indices=False), outdepth='uint16')
    
    
    
    if output_step == 'watershed':
        #watershed - can be improved likely
        #ff = filters.threshold_li(np.max(nvol, axis=0))
        #wtsd = watershed(ff, label(pk))
        wtsd = watershed(delta_wt_bt, label(pk))
        #wtsd = watershed(filters.sobel(sub), label(pk))
        #binarize
        wtsd[wtsd>np.median(wtsd)] = np.max(wtsd)
        wtsd[wtsd<np.median(wtsd)] = np.max(wtsd)
    
        #if a threshold is needed:
        #thresh = filters.threshold_otsu(sub)
        #then thresh at between thresh/2 and thresh/3    
        return tuple((i, wtsd))
    
    else: #laplace
        from scipy import ndimage
        #really nice at removing edges -- just figure out how to use it properly
        ##skimage.filters.sobel_h (very good!)
        #lsub = np.negative(ndimage.morphological_laplace(sub, 5))
        lsub = np.negative(cv2.Laplacian(sub,cv2.CV_64F, ksize=5))
        #POSSIBLY REMOVE
        return tuple((i, np.maximum(lsub, pk)))

#@jit 
def clip_percentile(im, low=50, high=99.999):
    low = np.percentile(im, low)
    high = np.percentile(im, high)
    im[im<low] = low
    im[im>high] = high
    return im
#@jit
def erode_and_dilate(max_d, med_d, vol):
    d1 = disk(max_d) #this does do something
    d2 = disk(med_d) #30 is good, 50 seems better, especially for dense label
    #sub = np.subtract(dilation(erosion(np.max(vol, axis=0), d1), d1), dilation(erosion(np.median(vol, axis=0), d2), d2))
    sub = cv2.subtract(cv2.dilate(cv2.erode(np.max(vol, axis=0), d1, iterations = 1), d1, iterations = 1).astype('float64'), cv2.dilate(cv2.erode(np.median(vol, axis=0), d2, iterations = 1), d2, iterations = 1))
    return sub
#@jit
def tophat(white_tophat_disk, sub):
    #wt = white_tophat(sub, disk(white_tophat_disk)) #20 is very good
    #bt = black_tophat(sub)
    wt = cv2.morphologyEx(sub, cv2.MORPH_TOPHAT, disk(white_tophat_disk))
    bt = cv2.morphologyEx(sub, cv2.MORPH_BLACKHAT, cv2.getStructuringElement(cv2.MORPH_CROSS,(white_tophat_disk,white_tophat_disk)))
    wt[bt>0] = 0 #delta_wt_bt
    return wt


#%%

if False:
    lst=['/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1131.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1132.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1133.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1134.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1135.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1136.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1137.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1138.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1139.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1140.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1141.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1142.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1143.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1144.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1145.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1146.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1147.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1148.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1149.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1150.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1151.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1152.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1153.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1154.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1155.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1156.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1157.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1158.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1159.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1160.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1161.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1162.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1163.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1164.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1165.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1166.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1167.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1168.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1169.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1170.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1171.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1172.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1173.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1174.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1175.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1176.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1177.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1178.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1179.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1180.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1181.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1182.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1183.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1184.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1185.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1186.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1187.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1188.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1189.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1190.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1191.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1192.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1193.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1194.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1195.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1196.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1197.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1198.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1199.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1200.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1201.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1202.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1203.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1204.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1205.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1206.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1207.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1208.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1209.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1210.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1211.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1212.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1213.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1214.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1215.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1216.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1217.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1218.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1219.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1220.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1221.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1222.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1223.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1224.tif', '/home/wanglab/wang/pisano/tracing_output/antero/20170115_tp_bl6_lob6a_rpv_03/full_sizedatafld/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_ch02/20170115_tp_bl6_lob6a_rpv_03_488_555_647_0005na_1hfsds_z3um_150msec_C02_Z1225.tif']
    lst.sort()
    print len(lst)
    s = np.asarray([tifffile.imread(i) for i in lst[:15]])
    
    #b = dilation(erosion(np.subtract(np.max(s, axis=0), np.min(s, axis=0)), square(3)), square(3))
    #%% #can do this on a rolling mean/median in z
    #bb = square(5)
    #bb = disk(3)
    #cc = disk(25)
    bb = disk(1) #this does something
    cc = disk(30)
    
    #aa = dilation(erosion(np.max(s, axis=0), bb), bb)
    #pr = np.percentile(aa, 50)
    #aa[aa<pr]=0
    #sitk.Show(sitk.GetImageFromArray(change_bitdepth(aa, outdepth='uint16')))    
    
    
    b = np.subtract(
            
            dilation(erosion(np.max(s, axis=0), bb), bb),
          #dilation(erosion(np.min(s, axis=0), cc), cc))#.astype('float')) #MEDIAN BETTER THAN MIN
          dilation(erosion(np.median(s, axis=0), cc), cc))
    
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(b, outdepth='uint16')))    
    
    ##compare median vs min to subrtract and percentile out median value of min image from values
    
    #%%
    from skimage.morphology import white_tophat, black_tophat
    #possibly use as seeds for watershed?
    wt = white_tophat(b, square(20))
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(wt, outdepth='uint16')))   
    
    #bt seems to be very good at delinating clusters of cells -- make this + spots black on image to parse out cells before watershedding
    bt = black_tophat(b)
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(bt, outdepth='uint16')))   
    
    
    #b_bt = np.copy(b)
    b_bt = np.copy(wt)
    b_bt[bt>0] = 0
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(b_bt, outdepth='uint16')))   
    
    #%%
    from skimage import filters
    gb = filters.gabor(b,0.6) #the imaginary part[1] is pretty nice
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(np.add(gb[0], gb[1]), outdepth='uint16')))   
    #sitk.Show(sitk.GetImageFromArray(change_bitdepth(filters.threshold_sauvola(b), outdepth='uint16')))   
     
    #%%
    from skimage.feature import peak_local_max
    pk = change_bitdepth(peak_local_max(b_bt, min_distance=2, threshold_rel=0.05, indices=False), outdepth='uint16')
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(pk, outdepth='uint16')))   
    
    from scipy import ndimage
    aaa=ndimage.distance_transform_edt(pk)
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(aaa, outdepth='uint16')))   
    #%%
    from skimage.morphology import watershed
    from skimage.measure import label
    wtsd = watershed(b, b_bt)
    wtsd = watershed(filters.sobel(b), label(pk))
    sitk.Show(sitk.GetImageFromArray(change_bitdepth(wtsd, outdepth='uint16')))   
    #possibly make a mask of larger 'sheens'
